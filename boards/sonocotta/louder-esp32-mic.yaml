# Sonocotta Louder-ESP32-Mic Hardware Profile
# TAS5805M DAC + Amplifier (25W @ 8Ω) with 15-band EQ + Microphone Header
# https://github.com/sonocotta/esp32-audio-dock
#
# ⚠️ This package contains ONLY hardware-specific settings.
# Add application logic (LED, IR, switches, EQ bands, fault monitoring) in your main config.
#
# Compatible with: Rev H6 (ESP32 with mic header support)
# For Rev H-H5 (without mic): Use louder-esp32.yaml
# Revision notes:
#   - LED: GPIO27 (standard for H6)
#   - IR: GPIO34 (standard)
#   - PWDN: GPIO21 (all revisions)
#   - Mic pins: WS=GPIO13, BCK=GPIO5, DIN=GPIO25

substitutions:
  board_type: "Louder-ESP32-Mic"
  board_revision: "H6"
  task_stack_in_psram: "false"  # ESP32 requires false
  
  # Hardware pins:
  tas5805m_enable_pin: "GPIO21"  # PWDN pin
  led_pin: "GPIO27"              # Standard for H6
  ir_pin: "GPIO34"               # Standard
  mic_ws_pin: "GPIO13"           # Mic WS
  mic_bck_pin: "GPIO5"           # Mic BCK
  mic_din_pin: "GPIO25"          # Mic data input

esp32:
  board: esp32dev
  flash_size: 8MB
  framework:
    type: esp-idf
    version: recommended
    sdkconfig_options:
      CONFIG_BT_ALLOCATION_FROM_SPIRAM_FIRST: "y"
      CONFIG_BT_BLE_DYNAMIC_ENV_MEMORY: "y"
      CONFIG_MBEDTLS_EXTERNAL_MEM_ALLOC: "y"
      CONFIG_MBEDTLS_SSL_PROTO_TLS1_3: "y"

psram:
  mode: quad
  speed: 40MHz
  ignore_not_found: false

# I2C Configuration for TAS5805M
i2c:
  sda: GPIO16
  scl: GPIO1
  frequency: 400kHz
  scan: true

# I2S Audio Configuration (Speaker output)
i2s_audio:
  i2s_lrclk_pin: GPIO22  # WS
  i2s_bclk_pin: GPIO26   # BCK

# TAS5805M DAC Hardware Configuration
external_components:
  - source: github://mrtoy-me/esphome-tas5805m@main
    components: [ tas5805m ]
    refresh: 60s

audio_dac:
  - platform: tas5805m
    id: tas5805m_dac
    enable_pin: ${tas5805m_enable_pin}
    dac_mode: BTL           # BTL (stereo) or PBTL (mono bridged)
    mixer_mode: STEREO      # STEREO, STEREO_INVERSE, MONO, LEFT, RIGHT
    analog_gain_left_db: 0
    analog_gain_right_db: 0
